{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "XOne Configuration",
  "type": "object",
  "properties": {
    "Server": {
      "type": "object",
      "properties": {
        "Name": { "type": "string" },
        "Version": { "type": "string", "default": "v0.0.1" },
        "Profiles": {
          "type": "object",
          "properties": {
            "Active": { "type": "string" }
          }
        }
      },
      "required": ["Name"]
    },
    "XAxum": {
      "type": "object",
      "properties": {
        "Host": { "type": "string", "default": "0.0.0.0" },
        "Port": { "type": "integer", "default": 8000 },
        "UseHttp2": { "type": "boolean", "default": false },
        "EnableBanner": { "type": "boolean", "default": true, "description": "是否打印启动 ASCII art Banner" },
        "Swagger": {
          "type": "object",
          "properties": {
            "Host": { "type": "string" },
            "BasePath": { "type": "string" },
            "Title": { "type": "string" },
            "Description": { "type": "string" },
            "Schemes": { "type": "array", "items": { "type": "string" }, "default": ["https", "http"] }
          }
        }
      }
    },
    "XLog": {
      "type": "object",
      "properties": {
        "Level": { "type": "string", "enum": ["trace", "debug", "info", "warn", "error"], "default": "info" },
        "Name": { "type": "string", "default": "app" },
        "Path": { "type": "string", "default": "./log" },
        "Console": { "type": "boolean", "default": false },
        "ConsoleFormatIsRaw": { "type": "boolean", "default": false },
        "MaxAge": { "type": "string", "default": "7d" },
        "RotateTime": { "type": "string", "default": "1d" },
        "Timezone": { "type": "string", "default": "Asia/Shanghai" }
      }
    },
    "XTrace": {
      "type": "object",
      "properties": {
        "Enable": { "type": "boolean", "default": true },
        "Console": { "type": "boolean", "default": false }
      }
    },
    "XHttp": {
      "type": "object",
      "properties": {
        "Timeout": { "type": "string", "default": "30s" },
        "DialTimeout": { "type": "string", "default": "10s" },
        "DialKeepAlive": { "type": "string", "default": "30s" },
        "MaxIdleConnsPerHost": { "type": "integer", "default": 100 },
        "PoolMaxIdlePerHost": { "type": "integer", "default": 10 },
        "RetryCount": { "type": "integer", "default": 0 },
        "RetryWaitTime": { "type": "string", "default": "1s" },
        "RetryMaxWaitTime": { "type": "string", "default": "10s" }
      }
    },
    "XOrm": {
      "oneOf": [
        { "$ref": "#/definitions/XOrmConfig" },
        { "type": "array", "items": { "$ref": "#/definitions/XOrmConfig" } }
      ]
    },
    "XCache": {
      "oneOf": [
        { "$ref": "#/definitions/XCacheConfig" },
        { "type": "array", "items": { "$ref": "#/definitions/XCacheConfig" } }
      ]
    }
  },
  "definitions": {
    "XOrmConfig": {
      "type": "object",
      "description": "数据库连接池配置，使用 connect_lazy 同步创建，首次查询时建立连接",
      "properties": {
        "Driver": { "type": "string", "enum": ["postgres", "mysql"], "default": "postgres", "description": "数据库驱动类型" },
        "DSN": { "type": "string", "description": "数据库连接字符串（空则跳过该实例）" },
        "MaxOpenConns": { "type": "integer", "default": 100, "description": "最大连接数" },
        "MaxIdleConns": { "type": "integer", "default": 10, "description": "最小空闲连接数" },
        "MaxLifetime": { "type": "string", "default": "1h", "description": "连接最长存活时间" },
        "MaxIdleTime": { "type": "string", "default": "10m", "description": "空闲连接回收时间" },
        "SlowThreshold": { "type": "string", "default": "200ms", "description": "慢查询阈值" },
        "EnableLog": { "type": "boolean", "default": true, "description": "是否启用 SQL 日志" },
        "Name": { "type": "string", "default": "", "description": "实例名称（多实例模式标识）" }
      }
    },
    "XCacheConfig": {
      "type": "object",
      "properties": {
        "MaxCapacity": { "type": "integer", "default": 100000 },
        "DefaultTTL": { "type": "string", "default": "5m" },
        "Name": { "type": "string", "default": "" }
      }
    }
  }
}
